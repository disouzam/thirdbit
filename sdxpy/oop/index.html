<!DOCTYPE html>
<html lang="en">
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="repo" content="https://github.com/gvwilson/sdxpy">
  <meta name="build_date" content="2023-07-16">
  <meta name="template" content="default">
  <meta name="major" content="Chapter 2">
  <meta name="has_slides" content="true">
  <link rel="icon" type="image/x-icon" href="../favicon.ico">
  <link rel="stylesheet" href="../mccole.css">
  <link rel="stylesheet" href="../tango.css">
  <script defer data-domain="third-bit.com" src="https://plausible.io/js/plausible.js"></script>
  <script>
    MathJax = {
      tex: {
        inlineMath: [['\\(', '\\)']]
      }
    };
  </script>
  <script
    type="text/javascript"
    id="MathJax-script"
    async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
  <script defer src="../mccole.js"></script>
  <title>Software Design by Example: Objects and Classes</title>
</head>

  <body>
    <div class="row">
      <div class="sidebar">
        <p>
  
  <img src="../logo.svg" alt="site logo" class="logo" />
  <a href="../">Software Design by Example</a>
  
</p>
<ol class="toc-chapter">
  
  <li>
    <a href="../intro/">
      Introduction
    </a>
  </li>
  
  <li>
    <a href="../oop/">
      <strong>Objects and Classes</strong>
    </a>
  </li>
  
  <li>
    <a href="../dup/">
      Finding Duplicate Files
    </a>
  </li>
  
  <li>
    <a href="../glob/">
      Matching Patterns
    </a>
  </li>
  
  <li>
    <a href="../parse/">
      Parsing Text
    </a>
  </li>
  
  <li>
    <a href="../test/">
      Running Tests
    </a>
  </li>
  
  <li>
    <a href="../interp/">
      An Interpreter
    </a>
  </li>
  
  <li>
    <a href="../func/">
      Functions and Closures
    </a>
  </li>
  
  <li>
    <a href="../reflect/">
      Reflection
    </a>
  </li>
  
  <li>
    <a href="../archive/">
      A File Archiver
    </a>
  </li>
  
  <li>
    <a href="../check/">
      An HTML Validator
    </a>
  </li>
  
  <li>
    <a href="../template/">
      A Template Expander
    </a>
  </li>
  
  <li>
    <a href="../lint/">
      A Code Linter
    </a>
  </li>
  
  <li>
    <a href="../layout/">
      Page Layout
    </a>
  </li>
  
  <li>
    <a href="../perf/">
      Performance Profiling
    </a>
  </li>
  
  <li>
    <a href="../persist/">
      Object Persistence
    </a>
  </li>
  
  <li>
    <a href="../binary/">
      Binary Data
    </a>
  </li>
  
  <li>
    <a href="../db/">
      A Database
    </a>
  </li>
  
  <li>
    <a href="../build/">
      A Build Manager
    </a>
  </li>
  
  <li>
    <a href="../pack/">
      A Package Manager
    </a>
  </li>
  
  <li>
    <a href="../ftp/">
      Transferring Files
    </a>
  </li>
  
  <li>
    <a href="../http/">
      Serving Web Pages
    </a>
  </li>
  
  <li>
    <a href="../viewer/">
      A File Viewer
    </a>
  </li>
  
  <li>
    <a href="../undo/">
      Undo and Redo
    </a>
  </li>
  
  <li>
    <a href="../vm/">
      A Virtual Machine
    </a>
  </li>
  
  <li>
    <a href="../debugger/">
      A Debugger
    </a>
  </li>
  
  <li>
    <a href="../finale/">
      Conclusion
    </a>
  </li>
  
</ol>
<ol class="toc-appendix">
  
  <li>
    <a href="../bib/">
      Bibliography
    </a>
  </li>
  
  <li>
    <a href="../bonus/">
      Bonus Material
    </a>
  </li>
  
  <li>
    <a href="../syllabus/">
      Syllabus
    </a>
  </li>
  
  <li>
    <a href="../slides/">
      Slides
    </a>
  </li>
  
  <li>
    <a href="../license/">
      License
    </a>
  </li>
  
  <li>
    <a href="../conduct/">
      Code of Conduct
    </a>
  </li>
  
  <li>
    <a href="../contrib/">
      Contributing
    </a>
  </li>
  
  <li>
    <a href="../glossary/">
      Glossary
    </a>
  </li>
  
  <li>
    <a href="../credits/">
      Credits
    </a>
  </li>
  
  <li>
    <a href="../contents/">
      Index
    </a>
  </li>
  
</ol>

<p><a href="../sdxpy-examples.zip" type="application/zip">download examples</a></p>


      </div>
      <div id="printable" class="contents bordered">
        <main>
          
  <h1>Chapter 2: Objects and Classes</h1>


          
<div class="draft notex">
  <p class="draft">
    DRAFT 2023-07-16
  </p>
  <p>
    <em>Please use section heading links to submit feedback.</em>
  </p>
</div>


          
  

  
  <ul class="syllabus">
  
  <li markdown="1">Objects are useful without classes, but classes make them easier to understand.</li>
  
  <li markdown="1">A well-designed class defines a contract that code using its instances can rely on.</li>
  
  <li markdown="1">Objects that respect the same contract are polymorphic, i.e., they can be used interchangeably even if they do different specific things.</li>
  
  <li markdown="1">Objects and classes can be thought of as dictionaries with stereotyped behavior.</li>
  
  <li markdown="1">Most programming languages allow functions and methods to take a variable number of arguments.</li>
  
  <li markdown="1">Inheritance can be implemented in several ways that differ in the order in which objects and classes are searched for methods.</li>
  
  </ul>
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  


          
<p class="definitions">
  Terms defined: <a class="gl-ref" href="../glossary/#gl:cache" markdown="1">cache</a>, <a class="gl-ref" href="../glossary/#gl:class_method" markdown="1">class method</a>, <a class="gl-ref" href="../glossary/#gl:constructor" markdown="1">constructor</a>, <a class="gl-ref" href="../glossary/#gl:design_by_contract" markdown="1">design by contract</a>, <a class="gl-ref" href="../glossary/#gl:monkey_patching" markdown="1">monkey patching</a>, <a class="gl-ref" href="../glossary/#gl:multiple_inheritance" markdown="1">multiple inheritance</a>, <a class="gl-ref" href="../glossary/#gl:polymorphism" markdown="1">polymorphism</a>, <a class="gl-ref" href="../glossary/#gl:spread" markdown="1">spread</a>, <a class="gl-ref" href="../glossary/#gl:static_method" markdown="1">static method</a>
</p>


          <div class="page-toc"></div>
          <p>We have created a lot of objects and classes in previous lessons.
Historically,
they were invented to solve two problems:</p>
<ol>
<li>
<p>What is a natural way to represent real-world &ldquo;things&rdquo; in code?</p>
</li>
<li>
<p>How can we organize code to make it easier to understand, test, and extend?</p>
</li>
</ol>
<h2 id="oop-objects">Section 2.1: Objects</h2>
<p>Let&rsquo;s start by defining the things a generic two-dimensional shape must be able to do:</p>
<div class="code-sample lang-py" title="shapes_original.py">
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Shape</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span> <span class="nf">perimeter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;perimeter&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">area</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;area&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
<p class="continue">A specification like this is sometimes called
a <a class="gl-ref" href="../glossary/#gl:design_by_contract" title="A style of designing software in which functions specify the pre-conditions that must be true in order for them to run and the post-conditions they guarantee will be true when they return. A function can then be replaced by one with weaker pre-conditions (i.e., it accepts a wider set of input) and/or stronger post-conditions (i.e., it produces a smaller range of output) without breaking anything else." markdown="1">contract</a>
because any particular shape must conform to it:</p>
<div class="code-sample lang-py" title="shapes_original.py">
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Square</span><span class="p">(</span><span class="n">Shape</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">side</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">side</span> <span class="o">=</span> <span class="n">side</span>

    <span class="k">def</span> <span class="nf">perimeter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">4</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">side</span>

    <span class="k">def</span> <span class="nf">area</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">side</span> <span class="o">**</span> <span class="mi">2</span>

<span class="k">class</span> <span class="nc">Circle</span><span class="p">(</span><span class="n">Shape</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span>

    <span class="k">def</span> <span class="nf">perimeter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span>

    <span class="k">def</span> <span class="nf">area</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">**</span> <span class="mi">2</span>
</code></pre></div>
</div>
<p>More importantly,
code that uses shapes can <em>rely</em> on the contract
and use different shapes interchangeably.</p>
<div class="code-sample lang-py" title="shapes_original.py">
<div class="highlight"><pre><span></span><code><span class="n">examples</span> <span class="o">=</span> <span class="p">[</span><span class="n">Square</span><span class="p">(</span><span class="s2">&quot;sq&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">Circle</span><span class="p">(</span><span class="s2">&quot;ci&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">ex</span> <span class="ow">in</span> <span class="n">examples</span><span class="p">:</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">ex</span><span class="o">.</span><span class="n">name</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">ex</span><span class="o">.</span><span class="n">perimeter</span><span class="p">()</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">ex</span><span class="o">.</span><span class="n">area</span><span class="p">()</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">ex</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> is a </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">p</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">p</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
<p>This is called <a class="gl-ref" href="../glossary/#gl:polymorphism" title="Having many different implementations of the same interface. If a set of functions or objects are polymorphic, they can be called interchangeably." markdown="1">polymorphism</a>.
It reduces <span class="ix-entry" ix-key="cognitive load" markdown="1">cognitive load</span>
by allowing the people using a set of related things
(in this case, <span class="ix-entry" ix-key="object" markdown="1">objects</span>)
to ignore their differences.</p>
<p>But how does it work?
To find out,
let&rsquo;s use a <span class="ix-entry" ix-key="dictionary" markdown="1">dictionary</span> to represent a square
and write some functions that to
the same things as the <span class="ix-entry" ix-key="method" markdown="1">methods</span> in our earlier classes:</p>
<div class="code-sample lang-py" title="shapes_dict.py">
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">square_perimeter</span><span class="p">(</span><span class="n">thing</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">thing</span><span class="p">[</span><span class="s2">&quot;side&quot;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">square_area</span><span class="p">(</span><span class="n">thing</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">thing</span><span class="p">[</span><span class="s2">&quot;side&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>

<span class="k">def</span> <span class="nf">square_new</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">side</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
        <span class="s2">&quot;side&quot;</span><span class="p">:</span> <span class="n">side</span><span class="p">,</span>
        <span class="s2">&quot;perimeter&quot;</span><span class="p">:</span> <span class="n">square_perimeter</span><span class="p">,</span>
        <span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="n">square_area</span>
    <span class="p">}</span>
</code></pre></div>
</div>
<p>Crucially,
the square&rsquo;s dictionary stores references to
the functions that know how to operate on squares (<a class="fig-ref" href="../oop/#oop-shapes-dict">Figure 2.1</a>).</p>
<figure id="oop-shapes-dict">
<img src="./shapes_dict.svg" alt="Storing shapes as dictionaries"/>
<figcaption markdown="1">Figure 2.1: Using dictionaries to emulate objects.</figcaption>
</figure>

<p>Behind the scenes,
this is (almost) how objects actually work.
We can think of an object as a special kind of dictionary.
A method is just a function that takes an object object of the right kind
as its first <span class="ix-entry" ix-key="parameter" markdown="1">parameter</span>
(typically called <code>self</code> in Python).</p>
<p>Here&rsquo;s how we call methods:</p>
<div class="code-sample lang-py" title="shapes_dict.py">
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="n">method_name</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">thing</span><span class="p">[</span><span class="n">method_name</span><span class="p">](</span><span class="n">thing</span><span class="p">)</span>

<span class="n">examples</span> <span class="o">=</span> <span class="p">[</span><span class="n">square_new</span><span class="p">(</span><span class="s2">&quot;sq&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">circle_new</span><span class="p">(</span><span class="s2">&quot;ci&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">ex</span> <span class="ow">in</span> <span class="n">examples</span><span class="p">:</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">ex</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">call</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s2">&quot;perimeter&quot;</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">call</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s2">&quot;area&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">p</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">p</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
<p>The function <code>call</code> looks up the function stored in the dictionary,
then calls that function with the dictionary as its first object.
In other words,
instead of using <code>obj.meth(arg)</code> we use <code>obj["meth"](obj, arg)</code>,
but the former is really just the latter in disguise.</p>
<h2 id="oop-classes">Section 2.2: Classes</h2>
<p>One problem with implementing objects as dictionaries is that
it allows every single object to behave slightly differently.
In practice,
we want objects to have different properties
(e.g., different squares to have different sizes)
but the same behaviors
(e.g., all squares should have the same methods).
We can implement this by storing the methods in a dictionary called <code>Square</code>
that corresponds to a class,
and have each particular square contain a reference to that higher-level dictionary
(<a class="fig-ref" href="../oop/#oop-shapes-class">Figure 2.2</a>):</p>
<div class="code-sample lang-py" title="shapes_class.py">
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">square_perimeter</span><span class="p">(</span><span class="n">thing</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">thing</span><span class="p">[</span><span class="s2">&quot;side&quot;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">square_area</span><span class="p">(</span><span class="n">thing</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">thing</span><span class="p">[</span><span class="s2">&quot;side&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>

<span class="n">Square</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;perimeter&quot;</span><span class="p">:</span> <span class="n">square_perimeter</span><span class="p">,</span>
    <span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="n">square_area</span><span class="p">,</span>
    <span class="s2">&quot;_classname&quot;</span><span class="p">:</span> <span class="s2">&quot;Square&quot;</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">square_new</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">side</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
        <span class="s2">&quot;side&quot;</span><span class="p">:</span> <span class="n">side</span><span class="p">,</span>
        <span class="s2">&quot;_class&quot;</span><span class="p">:</span> <span class="n">Square</span>
    <span class="p">}</span>
</code></pre></div>
</div>
<figure id="oop-shapes-class">
<img src="./shapes_class.svg" alt="Separating properties from methods"/>
<figcaption markdown="1">Figure 2.2: Using dictionaries to emulate classes.</figcaption>
</figure>

<p>Calling a method now involves one more lookup
because we have go to from the object to the class to the method,
but once again we call the &ldquo;method&rdquo; with the object as the first argument:</p>
<div class="code-sample lang-py" title="shapes_class.py">
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="n">method_name</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">thing</span><span class="p">[</span><span class="s2">&quot;_class&quot;</span><span class="p">][</span><span class="n">method_name</span><span class="p">](</span><span class="n">thing</span><span class="p">)</span>

<span class="n">examples</span> <span class="o">=</span> <span class="p">[</span><span class="n">square_new</span><span class="p">(</span><span class="s2">&quot;sq&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">circle_new</span><span class="p">(</span><span class="s2">&quot;ci&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">ex</span> <span class="ow">in</span> <span class="n">examples</span><span class="p">:</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">ex</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">call</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s2">&quot;perimeter&quot;</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">call</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s2">&quot;area&quot;</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">ex</span><span class="p">[</span><span class="s2">&quot;_class&quot;</span><span class="p">][</span><span class="s2">&quot;_classname&quot;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> is a </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">p</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">p</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
<p class="continue">As a bonus,
we can now reliably identify objects&rsquo; classes
and ask whether two objects have the same class or not.</p>
<div class="callout">
<h3>Variable Arguments</h3>
<p>Like most modern programming languages,
Python allows us to define functions that take a variable number of <span class="ix-entry" ix-key="argument" markdown="1">arguments</span>,
and to call functions by <a class="gl-ref" href="../glossary/#gl:spread" title="To automatically match the values from a list or dictionary supplied by the caller to the parameters of a function." markdown="1">spreading</a> a list or dictionary:</p>
<div class="code-sample lang-py" title="varargs.py">
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">show_args</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2"> args &#39;</span><span class="si">{</span><span class="n">args</span><span class="si">}</span><span class="s2">&#39; and kwargs &#39;</span><span class="si">{</span><span class="n">kwargs</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

<span class="n">show_args</span><span class="p">(</span><span class="s2">&quot;nothing&quot;</span><span class="p">)</span>
<span class="n">show_args</span><span class="p">(</span><span class="s2">&quot;one unnamed argument&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">show_args</span><span class="p">(</span><span class="s2">&quot;one named argument&quot;</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="s2">&quot;2&quot;</span><span class="p">)</span>
<span class="n">show_args</span><span class="p">(</span><span class="s2">&quot;one of each&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">fourth</span><span class="o">=</span><span class="s2">&quot;4&quot;</span><span class="p">)</span>

<span class="n">a_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
<span class="n">a_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;nine&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s2">&quot;ten&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>
<span class="n">show_args</span><span class="p">(</span><span class="s2">&quot;direct&quot;</span><span class="p">,</span> <span class="n">a_list</span><span class="p">,</span> <span class="n">a_dict</span><span class="p">)</span>
<span class="n">show_args</span><span class="p">(</span><span class="s2">&quot;spreading&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">a_list</span><span class="p">,</span> <span class="o">**</span><span class="n">a_dict</span><span class="p">)</span>
</code></pre></div>
</div>
<div class="code-sample lang-out" title="varargs.out">
<div class="highlight"><pre><span></span><code>nothing args &#39;()&#39; and kwargs &#39;{}&#39;
one unnamed argument args &#39;(1,)&#39; and kwargs &#39;{}&#39;
one named argument args &#39;()&#39; and kwargs &#39;{&#39;second&#39;: &#39;2&#39;}&#39;
one of each args &#39;(3,)&#39; and kwargs &#39;{&#39;fourth&#39;: &#39;4&#39;}&#39;
direct args &#39;([7, 8], {&#39;nine&#39;: 9, &#39;ten&#39;: 10})&#39; and kwargs &#39;{}&#39;
spreading args &#39;(7, 8)&#39; and kwargs &#39;{&#39;nine&#39;: 9, &#39;ten&#39;: 10}&#39;
</code></pre></div>
</div>
</div>
<h2 id="oop-inheritance">Section 2.3: Inheritance</h2>
<p>The last step in building our own object system is to implement <span class="ix-entry" ix-key="inheritance" markdown="1">inheritance</span>.
First,
we add a method to our original <code>Shape</code> class that uses methods defined
in <span class="ix-entry" ix-key="derived class" markdown="1">derived classes</span>:</p>
<div class="code-sample lang-py" title="inherit_original.py">
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Shape</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span> <span class="nf">perimeter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;perimeter&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">area</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;area&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">weight</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span><span class="p">()</span>
</code></pre></div>
</div>
<p class="continue">and check that it works:</p>
<div class="code-sample lang-py" title="inherit_original.py">
<div class="highlight"><pre><span></span><code><span class="n">examples</span> <span class="o">=</span> <span class="p">[</span><span class="n">Square</span><span class="p">(</span><span class="s2">&quot;sq&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">Circle</span><span class="p">(</span><span class="s2">&quot;ci&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">ex</span> <span class="ow">in</span> <span class="n">examples</span><span class="p">:</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">ex</span><span class="o">.</span><span class="n">name</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">ex</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">d</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
<div class="code-sample lang-out" title="inherit_original.out">
<div class="highlight"><pre><span></span><code>sq: 0.56
ci: 0.40
</code></pre></div>
</div>
<p>To enable our dictionary-based &ldquo;classes&rdquo; to do the same thing,
we add a similar &ldquo;method&rdquo; to the dictionary representing a generic shape:</p>
<div class="code-sample lang-py" title="inherit_class.py">
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">shape_density</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="n">weight</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">weight</span> <span class="o">/</span> <span class="n">call</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="s2">&quot;area&quot;</span><span class="p">)</span>

<span class="n">Shape</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;density&quot;</span><span class="p">:</span> <span class="n">shape_density</span><span class="p">,</span>
    <span class="s2">&quot;_classname&quot;</span><span class="p">:</span> <span class="s2">&quot;Shape&quot;</span><span class="p">,</span>
    <span class="s2">&quot;_parent&quot;</span><span class="p">:</span> <span class="kc">None</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">shape_new</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
        <span class="s2">&quot;_class&quot;</span><span class="p">:</span> <span class="n">Shape</span>
    <span class="p">}</span>
</code></pre></div>
</div>
<p>and then modify the <code>call</code> function to look up the chain of inheritance
to find the requested method (<a class="fig-ref" href="../oop/#oop-inherit-class">Figure 2.3</a>):</p>
<div class="code-sample lang-py" title="inherit_class.py">
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="n">method_name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="n">method</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">thing</span><span class="p">[</span><span class="s2">&quot;_class&quot;</span><span class="p">],</span> <span class="n">method_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">method_name</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">cls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;method_name&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">method_name</span> <span class="ow">in</span> <span class="bp">cls</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">[</span><span class="n">method_name</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">find</span><span class="p">(</span><span class="bp">cls</span><span class="p">[</span><span class="s2">&quot;_parent&quot;</span><span class="p">],</span> <span class="n">method_name</span><span class="p">)</span>
</code></pre></div>
</div>
<figure id="oop-inherit-class">
<img src="./inherit_class.svg" alt="Implementing inheritance"/>
<figcaption markdown="1">Figure 2.3: Using dictionary search to implement inheritance.</figcaption>
</figure>

<p>A simple test shows that this is working as intended:</p>
<div class="code-sample lang-py" title="inherit_class.py">
<div class="highlight"><pre><span></span><code><span class="n">examples</span> <span class="o">=</span> <span class="p">[</span><span class="n">square_new</span><span class="p">(</span><span class="s2">&quot;sq&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">circle_new</span><span class="p">(</span><span class="s2">&quot;ci&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">ex</span> <span class="ow">in</span> <span class="n">examples</span><span class="p">:</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">ex</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">call</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s2">&quot;density&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">d</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
<div class="code-sample lang-out" title="inherit_class.out">
<div class="highlight"><pre><span></span><code>sq: 0.56
ci: 0.40
</code></pre></div>
</div>
<p>We do have one task left, though:
we need to make sure that when a square or circle is made,
it is made correctly.
In short, we need to implement <a class="gl-ref" href="../glossary/#gl:constructor" title="A function that creates an object of a particular class." markdown="1">constructors</a>.
We do this by giving the dictionaries that implements classes
a special key <code>_new</code>
whose value is the function that builds something of that type:</p>
<div class="code-sample lang-py" title="inherit_constructor.py">
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">[</span><span class="s2">&quot;_new&quot;</span><span class="p">](</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">shape_new</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
        <span class="s2">&quot;_class&quot;</span><span class="p">:</span> <span class="n">Shape</span>
    <span class="p">}</span>

<span class="k">def</span> <span class="nf">shape_density</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="n">weight</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">weight</span> <span class="o">/</span> <span class="n">call</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="s2">&quot;area&quot;</span><span class="p">)</span>

<span class="n">Shape</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;density&quot;</span><span class="p">:</span> <span class="n">shape_density</span><span class="p">,</span>
    <span class="s2">&quot;_classname&quot;</span><span class="p">:</span> <span class="s2">&quot;Shape&quot;</span><span class="p">,</span>
    <span class="s2">&quot;_parent&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;_new&quot;</span><span class="p">:</span> <span class="n">shape_new</span>
<span class="p">}</span>
</code></pre></div>
</div>
<p>The constructor function for a square now calls
the constructor function for a generic shape
and then adds square-specific values by using <code>|</code> to combine two dictionaries:</p>
<div class="code-sample lang-py" title="inherit_constructor.py">
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">square_new</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">side</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">make</span><span class="p">(</span><span class="n">Shape</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="o">|</span> <span class="p">{</span>
        <span class="s2">&quot;side&quot;</span><span class="p">:</span> <span class="n">side</span><span class="p">,</span>
        <span class="s2">&quot;_class&quot;</span><span class="p">:</span> <span class="n">Square</span>
    <span class="p">}</span>

<span class="n">Square</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;perimeter&quot;</span><span class="p">:</span> <span class="n">square_perimeter</span><span class="p">,</span>
    <span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="n">square_area</span><span class="p">,</span>
    <span class="s2">&quot;_classname&quot;</span><span class="p">:</span> <span class="s2">&quot;Square&quot;</span><span class="p">,</span>
    <span class="s2">&quot;_parent&quot;</span><span class="p">:</span> <span class="n">Shape</span><span class="p">,</span>
    <span class="s2">&quot;_new&quot;</span><span class="p">:</span> <span class="n">square_new</span>
<span class="p">}</span>
</code></pre></div>
</div>
<p>Of course,
we&rsquo;re not done until we test it:</p>
<div class="code-sample lang-py" title="inherit_constructor.py">
<div class="highlight"><pre><span></span><code><span class="n">examples</span> <span class="o">=</span> <span class="p">[</span><span class="n">make</span><span class="p">(</span><span class="n">Square</span><span class="p">,</span> <span class="s2">&quot;sq&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">make</span><span class="p">(</span><span class="n">Circle</span><span class="p">,</span> <span class="s2">&quot;ci&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">ex</span> <span class="ow">in</span> <span class="n">examples</span><span class="p">:</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">ex</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">call</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s2">&quot;density&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">d</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
<div class="code-sample lang-out" title="inherit_constructor.out">
<div class="highlight"><pre><span></span><code>sq: 0.56
ci: 0.40
</code></pre></div>
</div>
<h2 id="oop-summary">Section 2.4: Summary</h2>
<p>We have only scratched the surface of what Python&rsquo;s object system provides.
<a class="gl-ref" href="../glossary/#gl:multiple_inheritance" title="Inheriting from two or more classes when creating a new class." markdown="1">Multiple inheritance</a>,
<a class="gl-ref" href="../glossary/#gl:class_method" title="A function defined inside a class that takes the class object as an input rather than an instance of the class." markdown="1">class methods</a>,
<a class="gl-ref" href="../glossary/#gl:static_method" title="A function that is defined within a class but does not require either the class itself or an instance of the class as a parameter." markdown="1">static methods</a>,
and <a class="gl-ref" href="../glossary/#gl:monkey_patching" title="To replace methods in a class or object at run-time without modifying the original code." markdown="1">monkey patching</a> are all useful,
but all can be understood in terms of dictionaries
that contain references to properties, functions, and other dictionaries.</p>
<figure id="oop-concept-map">
<img src="./concept_map.svg" alt="Concept map for objects and classes"/>
<figcaption markdown="1">Figure 2.4: Concept map for implementing objects and classes.</figcaption>
</figure>

<h2 id="oop-exercises">Section 2.5: Exercises</h2>
<h3 class="exercise">Multiple Inheritance</h3>
<p>Implement <span class="ix-entry" ix-key="multiple inheritance" markdown="1">multiple inheritance</span> using dictionaries.
Does your implementation look methods up in the same order as Python would?</p>
<h3 class="exercise">Class Methods and Static Methods</h3>
<ol>
<li>
<p>Explain the differences between <span class="ix-entry" ix-key="class method" markdown="1">class methods</span>
    and <span class="ix-entry" ix-key="static method" markdown="1">static methods</span>.</p>
</li>
<li>
<p>Implement both using dictionaries.</p>
</li>
</ol>
<h3 class="exercise">Reporting Type</h3>
<p>Python <code>type</code> method reports the most specific type of an object,
while <code>isinstance</code> determines whether an object inherits from a type
either directly or indirectly.
Add your own versions of both to dictionary-based objects and classes.</p>
<h3 class="exercise">Method Caching</h3>
<p>Our implementation searches for the implementation of a method
every time that method is called.
An alternative is to add a <a class="gl-ref" href="../glossary/#gl:cache" title="Something that stores copies of data so that future requests for it can be satisfied more quickly. The CPU in a computer uses a hardware cache to hold recently-accessed values; many programs rely on a software cache to reduce network traffic and latency. Figuring out when something in a cache is out-of-date and should be replaced is one of the two hard problems in computer science." markdown="1">cache</a> to each object
to save the methods that have been looked up before.
For example,
each object could have a special key called <code>_cache</code> whose value is a dictionary.
The keys in that dictionary are the names of methods that have been called in the past,
and the values are the functions that were found to implement those methods.
Add this feature to our dictionary-based objects.
How much more complex does it make the code?
How much extra storage space does it need compared to repeated lookup?</p>
        </main>
      </div>
    </div>
  </body>
</html>
